---
import { Icon } from "astro-icon/components";

type Theme = "system" | "light" | "dark";

const themes = [
  { name: "system", icon: "bi:circle-half" },
  { name: "light", icon: "bi:sun-fill" },
  { name: "dark", icon: "bi:moon-fill" },
];
---

<div class="inline-flex flex-col gap-2">
  <button
    class="flex items-center gap-2 bg-primary text-white rounded py-1 px-2"
    type="button"
    aria-expanded="false"
  >
    <Icon name="bi:circle-half" /><span>System</span>
    <Icon name="bi:caret-down-fill" />
  </button>
  <ul class="inline-flex flex-col p-2 border rounded" role="menu">
    {
      themes.map((theme) => {
        return (
          <li class="" role="none">
            <button
              class="flex items-center gap-2 w-full py-1 px-2 hover:bg-primary hover:text-white rounded"
              type="button"
              role="menuitem"
            >
              <Icon name={theme.icon} />
              <span class="capitalize">{theme.name}</span>
            </button>
          </li>
        );
      })
    }
  </ul>
</div>

<script>
  const rootElement = document.documentElement;

  document.addEventListener("astro:page-load", () => {});

  document.addEventListener("astro:after-swap", () => {
    if (localStorage.theme === "dark" || !("theme" in localStorage)) {
      rootElement.classList.add("dark");
    } else {
      rootElement.classList.remove("dark");
    }
  });
</script>
